<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | Sapphire</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo.png') }}" type="image/png" />
    <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Montserrat:wght@700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      async function checkEmail() {
        const emailField = document.getElementById("email");
        const email = emailField.value.trim();
        const errorMsg = document.getElementById("email-error");
    
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          errorMsg.textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email.";
          return;
        }
    
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π email –≤ –±–∞–∑–µ
        const response = await fetch(`/check_email?email=${encodeURIComponent(email)}`);
        const data = await response.json();
    
        if (data.exists) {
          errorMsg.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.";
        } else {
          errorMsg.textContent = ""; // –æ—á–∏—â–∞–µ–º –æ—à–∏–±–∫—É
        }
      }
    
      window.addEventListener("DOMContentLoaded", () => {
        const emailInput = document.getElementById("email");
        emailInput.addEventListener("input", checkEmail);
      });
    </script>
    <script>
      function togglePassword(id) {
        const field = document.getElementById(id);
        field.type = field.type === 'password' ? 'text' : 'password';
      }

      function validateForm(event) {
        const name = document.getElementById('name').value.trim();
        const birth = new Date(document.getElementById('birth_date').value);
        const today = new Date();
        const year = birth.getFullYear();
        const age = today.getFullYear() - year;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;

        const nameValid = /^[A-Za-z–ê-–Ø–∞-—è–Å—ë\s]{2,}$/.test(name);
        if (!nameValid) {
          alert('–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 2 —Å–∏–º–≤–æ–ª–æ–≤.');
          event.preventDefault();
          return;
        }

        if (year < 1920 || age < 14) {
          alert('–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 14 –ª–µ—Ç –∏ –Ω–µ —Ä–∞–Ω–µ–µ 1920 –≥–æ–¥–∞.');
          event.preventDefault();
          return;
        }

        if (password !== confirmPassword) {
          alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.');
          event.preventDefault();
          return;
        }
      }
    </script>
  </head>
  <body class="bg-[#BCD9D7] text-[#2A3A3A] flex items-center justify-center min-h-screen">
    <div class="w-full max-w-xl px-10 py-12 rounded-lg shadow-xl bg-white animate-fade-in">
      <h1 class="text-4xl font-bold mb-6" style="color: #2A3A3A; font-family: 'Montserrat', sans-serif">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
      <form class="space-y-4" method="POST" onsubmit="validateForm(event)">
        <input id="name" name="name" type="text" placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" value="{{ name }}" required />
        <input id="birth_date" name="birth_date" type="date" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" value="{{ birth_date }}" required />
        <input id="height" name="height" type="number" placeholder="–†–æ—Å—Ç (—Å–º)" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" value="{{ height }}" required min="140" max="300" />
        <input id="weight" name="weight" type="number" step="0.1" placeholder="–í–µ—Å (–∫–≥)" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" value="{{ weight }}" required min="20" max="300" />
    
        <select name="lifestyle" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] bg-white focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" required>
            <option disabled selected>–í–∞—à –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</option>
            <option value="active" {% if lifestyle == 'active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–π</option>
            <option value="moderate" {% if lifestyle == 'moderate' %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
            <option value="passive" {% if lifestyle == 'passive' %}selected{% endif %}>–ü–∞—Å—Å–∏–≤–Ω—ã–π</option>
        </select>
    
        <select name="goal" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] bg-white focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" required>
            <option disabled selected>–¶–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</option>
            <option value="gain" {% if goal == 'gain' %}selected{% endif %}>–ù–∞–±–æ—Ä –≤–µ—Å–∞</option>
            <option value="lose" {% if goal == 'lose' %}selected{% endif %}>–ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
            <option value="maintain" {% if goal == 'maintain' %}selected{% endif %}>–ü—Ä–æ—Å—Ç–æ —Å–ª–µ–¥–∏—Ç—å</option>
        </select>
    
        <input id="email" name="email" type="email" placeholder="Email" class="w-full px-4 py-2 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" value="{{ email }}" required />
        <p id="email-error" class="text-red-500 text-sm mt-1"></p>

        <div class="relative">
          <input id="password" name="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full px-4 py-2 pr-10 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" required />
          <span onclick="togglePassword('password')" class="absolute right-4 top-2 cursor-pointer select-none">üëÅÔ∏è</span>
        </div>

        <div class="relative">
          <input id="confirm_password" name="confirm_password" type="password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" class="w-full px-4 py-2 pr-10 rounded-full border border-[#76B0A7] focus:outline-none focus:ring-2 focus:ring-[#76B0A7]" required />
          <span onclick="togglePassword('confirm_password')" class="absolute right-4 top-2 cursor-pointer select-none">üëÅÔ∏è</span>
        </div>

        <div class="text-sm text-gray-500">
          –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—è—Å—å, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="/policy" class="underline hover:text-[#5a8d87] transition-colors duration-200" target="_blank">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
        </div>

        <button type="submit" class="w-full py-3 mt-4 bg-[#76B0A7] text-white rounded-full text-lg hover:bg-[#5a8d87] transition-colors duration-300"
        onclick="window.location.href='main'">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </button>

        <div class="text-center text-sm text-gray-500 mt-2">
          –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
          <a href="/login" class="underline hover:text-[#5a8d87] transition-colors duration-200">–í–æ–π—Ç–∏</a>
        </div>
      </form>
    </div>
  </body>
</html>
